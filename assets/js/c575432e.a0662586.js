"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[6090],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),u=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=u(n),d=r,k=m["".concat(i,".").concat(d)]||m[d]||p[d]||l;return n?a.createElement(k,o(o({ref:t},c),{},{components:n})):a.createElement(k,o({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1e3:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return p}});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),o=["components"],s={sidebar_label:"Escrow",sidebar_position:8},i="What is an escrow?",u={unversionedId:"examples/escrow",id:"examples/escrow",title:"What is an escrow?",description:"An escrow is a special wallet to which some assets (e.g. money or stocks) are deposited and stored until certain conditions are met. In terms of smart contracts, an escrow is a wallet that is stored on a blockchain and, like a regular escrow, can receive some assets (e.g. a cryptocurrency or tokens) from one user and, when certain conditions are met, send them to another.",source:"@site/docs/examples/escrow.md",sourceDirName:"examples",slug:"/examples/escrow",permalink:"/examples/escrow",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/examples/escrow.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_label:"Escrow",sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"DAO",permalink:"/examples/DAO"},next:{title:"Lottery",permalink:"/examples/lottery"}},c={},p=[{value:"Logic",id:"logic",level:2},{value:"Interface",id:"interface",level:2},{value:"Type aliases",id:"type-aliases",level:3},{value:"Initialization config",id:"initialization-config",level:3},{value:"Functions",id:"functions",level:3},{value:"Meta state",id:"meta-state",level:3},{value:"Actions &amp; events",id:"actions--events",level:3},{value:"Source code",id:"source-code",level:2}],m={toc:p};function d(e){var t=e.components,n=(0,r.Z)(e,o);return(0,l.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"what-is-an-escrow"},"What is an escrow?"),(0,l.kt)("p",null,"An escrow is a special wallet to which some assets (e.g. money or stocks) are deposited and stored until certain conditions are met. In terms of smart contracts, an escrow is a wallet that is stored on a blockchain and, like a regular escrow, can receive some assets (e.g. a cryptocurrency or tokens) from one user and, when certain conditions are met, send them to another."),(0,l.kt)("p",null,"This article explains the programming interface, data structure, basic functions and explains their purpose. It can be used as is or modified to suit your own scenarios. Anyone can easily create their own application and run it on the Gear Network. Assets in escrow smart contract will be ",(0,l.kt)("a",{parentName:"p",href:"/examples/gft-20"},"Gear fungible tokens - gFT"),". The source code is available on ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/escrow"},"GitHub"),". "),(0,l.kt)("h2",{id:"logic"},"Logic"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Any user can create an escrow wallet as a buyer or seller."),(0,l.kt)("li",{parentName:"ul"},"A buyer can make a deposit or confirm a deal and close a wallet."),(0,l.kt)("li",{parentName:"ul"},"A seller can refund tokens from a paid wallet to a buyer."),(0,l.kt)("li",{parentName:"ul"},"Both buyer and seller can cancel a deal and close an unpaid wallet.")),(0,l.kt)("p",null,"One escrow wallet contains info about a ",(0,l.kt)("inlineCode",{parentName:"p"},"buyer"),", a ",(0,l.kt)("inlineCode",{parentName:"p"},"seller"),", wallet ",(0,l.kt)("inlineCode",{parentName:"p"},"state")," and an ",(0,l.kt)("inlineCode",{parentName:"p"},"amount")," of tokens that this wallet can store:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"struct Wallet {\n    buyer: ActorId,\n    seller: ActorId,\n    state: WalletState,\n    amount: u128,\n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"WalletState")," is an enum that stores a current state of a wallet:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"enum WalletState {\n    AwaitingDeposit,\n    AwaitingConfirmation,\n    Closed,\n}\n")),(0,l.kt)("h2",{id:"interface"},"Interface"),(0,l.kt)("h3",{id:"type-aliases"},"Type aliases"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"/// Escrow wallet ID.\ntype WalletId = U256;\n")),(0,l.kt)("h3",{id:"initialization-config"},"Initialization config"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct InitEscrow {\n    /// Address of a fungible token program.\n    pub ft_program_id: ActorId,\n}\n")),(0,l.kt)("h3",{id:"functions"},"Functions"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"fn create(&mut self, buyer: ActorId, seller: ActorId, amount: u128)\n")),(0,l.kt)("p",null,"Creates one escrow wallet and replies with its ID."),(0,l.kt)("p",null,"Requirements:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"msg::source()")," must be a buyer or seller for this wallet.")),(0,l.kt)("p",null,"Arguments:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"buyer"),": a buyer."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"seller"),": a seller."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"amount"),": an amount of tokens.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"async fn deposit(&mut self, wallet_id: WalletId)\n")),(0,l.kt)("p",null,"Makes a deposit from a buyer to an escrow wallet\nand changes a wallet state to ",(0,l.kt)("inlineCode",{parentName:"p"},"AwaitingConfirmation"),"."),(0,l.kt)("p",null,"Requirements:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"msg::source()")," must be a buyer for this wallet."),(0,l.kt)("li",{parentName:"ul"},"Wallet must not be paid or closed.")),(0,l.kt)("p",null,"Arguments:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"wallet_id"),": a wallet ID.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"async fn confirm(&mut self, wallet_id: WalletId)\n")),(0,l.kt)("p",null,"Confirms a deal by transferring tokens from an escrow wallet\nto a seller and changing a wallet state to ",(0,l.kt)("inlineCode",{parentName:"p"},"Closed"),"."),(0,l.kt)("p",null,"Requirements:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"msg::source()")," must be a buyer for this wallet."),(0,l.kt)("li",{parentName:"ul"},"Wallet must be paid and unclosed.")),(0,l.kt)("p",null,"Arguments:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"wallet_id"),": a wallet ID.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"async fn refund(&mut self, wallet_id: WalletId)\n")),(0,l.kt)("p",null,"Refunds tokens from an escrow wallet to a buyer\nand changes a wallet state back to ",(0,l.kt)("inlineCode",{parentName:"p"},"AwaitingDeposit"),"\n(that is, a wallet can be reused)."),(0,l.kt)("p",null,"Requirements:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"msg::source()")," must be a seller for this wallet."),(0,l.kt)("li",{parentName:"ul"},"Wallet must be paid and unclosed.")),(0,l.kt)("p",null,"Arguments:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"wallet_id"),": a wallet ID.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"async fn cancel(&mut self, wallet_id: WalletId)\n")),(0,l.kt)("p",null,"Cancels a deal and closes an escrow wallet by changing its state to ",(0,l.kt)("inlineCode",{parentName:"p"},"Closed"),"."),(0,l.kt)("p",null,"Requirements:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"msg::source()")," must be a buyer or seller for this wallet."),(0,l.kt)("li",{parentName:"ul"},"Wallet must not be paid or closed.")),(0,l.kt)("p",null,"Arguments:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"wallet_id"),": a wallet ID.")),(0,l.kt)("h3",{id:"meta-state"},"Meta state"),(0,l.kt)("p",null,"It is also possible to provide a smart contract the ability to report about its state without consuming gas. This can be done by using the ",(0,l.kt)("inlineCode",{parentName:"p"},"meta_state")," function. It gets the ",(0,l.kt)("inlineCode",{parentName:"p"},"EscrowState")," enum and replies with the ",(0,l.kt)("inlineCode",{parentName:"p"},"EscrowStateReply")," enum specified below:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"enum EscrowState {\n    GetInfo(WalletId),\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"enum EscrowStateReply {\n    Info(Account),\n}\n")),(0,l.kt)("h3",{id:"actions--events"},"Actions & events"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Action")," is an enum that is sent to a program and contains info about what it should do. After a successful processing of ",(0,l.kt)("strong",{parentName:"p"},"Action"),", a program replies with the ",(0,l.kt)("strong",{parentName:"p"},"Event")," enum that contains info about a processed ",(0,l.kt)("strong",{parentName:"p"},"Action")," and its result."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"enum EscrowAction {\n    Create {\n        buyer: ActorId,\n        seller: ActorId,\n        amount: u128,\n    },\n    Deposit(WalletId),\n    Confirm(WalletId),\n    Refund(WalletId),\n    Cancel(WalletId),\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"enum EscrowEvent {\n    Cancelled {\n        buyer: ActorId,\n        seller: ActorId,\n        amount: u128,\n    },\n    Refunded {\n        buyer: ActorId,\n        amount: u128,\n    },\n    Confirmed {\n        seller: ActorId,\n        amount: u128,\n    },\n    Deposited {\n        buyer: ActorId,\n        amount: u128,\n    },\n    Created(WalletId),\n}\n")),(0,l.kt)("h2",{id:"source-code"},"Source code"),(0,l.kt)("p",null,"The source code of this example of an escrow smart contract and the example of an implementation of its testing is available on ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/escrow"},"GitHub"),"."),(0,l.kt)("p",null,"For more details about testing smart contracts written on Gear, refer to the ",(0,l.kt)("a",{parentName:"p",href:"/developing-contracts/testing"},"Program Testing")," article."))}d.isMDXComponent=!0}}]);